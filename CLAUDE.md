# サッカーくじtoto予想Webアプリケーション 要求仕様書

## 概要
Jリーグを対象としたサッカーくじtoto（13試合の勝敗予想）の予想結果を表示するWebアプリケーション

## 対象範囲
- **対象くじ**: toto（13試合の勝敗予想）のみ
- **対象リーグ**: Jリーグのみ（海外サッカーやナショナルチーム戦は除外）

## システム構成

### フロントエンド
- **技術スタック**: Python + Flask
- **デザイン**: モダンでスポーティなデザイン

### バックエンド
- **技術スタック**: Python + Flask
- **API**: RESTful API（必要に応じてFastAPI使用）

### インフラ
- **デプロイ環境**: ローカル環境（Mac）
- **コンテナ**: Docker + docker-compose
- **データ保存**: 不要（メモリ上で処理）

## 機能要件

### Web画面機能
- **表示内容**:
  - 結果確定前の最新回くじ予想のみ表示
  - 各試合の予想結果: 1（ホーム勝ち）、0（引き分け）、2（ホーム負け）
  - 開催日時と締切時間
- **画面構成**: トップページのみのシンプル構成

### バッチ処理機能
- **実行頻度**: 1日1回（早朝自動実行）
- **手動実行**: APIエンドポイント経由で実行可能
- **実行タイミング**: 新しいくじが発表された翌日の早朝

#### バッチ処理内容
1. **くじ情報取得**: 直近開催くじとその対象試合を取得（第xxxx回）
2. **チーム成績取得**: チームごとの直近5試合の成績と得失点差を取得
3. **順位情報取得**: 現在の順位を取得
4. **予想計算**: 取得データを基に勝敗予想を実行

## データソース

### スクレイピング対象サイト
- **Jリーグ公式データサイト**: https://data.j-league.or.jp/
- **toto公式サイト**: くじ情報取得用

### 取得データ
#### toto公式サイトから
- 開催中のくじ情報（第xxxx回、対象試合一覧、開催日時、締切時間）

#### Jリーグ公式データサイトから
- 各チームの直近5試合の結果（勝敗、得点、失点）
- 現在の順位表
- ホーム/アウェイ別の成績

## 予想アルゴリズム

### 使用ファクター
1. **直近5試合の成績**（重要度: 高）
   - 勝ち点数: 勝利3点、引き分け1点、敗北0点
   - 評価方法: 5試合の平均勝ち点で評価
   - 得失点差: 5試合の平均得失点差で評価

2. **ホーム/アウェイ優位性**
   - ホームチーム: +5pts程度の優位性付与

3. **順位差**
   - 現在の順位による優劣判定

4. **直前試合結果**
   - 直近の調子による補正

### 予想ロジック
- **勝敗予想**: 上記ファクターを総合的に判定
- **引き分け予想**: 各回の13試合中、両チームの力が拮抗している上位3試合を引き分け予想

## エラーハンドリング・ログ

### リトライ処理
- **リトライ回数**: 3回
- **リトライ間隔**: 10秒

### ログ出力
- バッチ処理の実行ログ
- エラー発生時の詳細ログ
- 後からアラート通知が可能な形式で出力

## 起動・操作方法

### アプリケーション起動
```bash
docker-compose up
```

### バッチ処理手動実行
- APIエンドポイント経由での実行

## 将来的な拡張予定
- AWSでの本格運用（現時点では実装不要）
- 的中率の記録・表示機能（現時点では実装不要）

## 開発指針

### コーディング規約
- **PEP8準拠**: Pythonコードは PEP8 に従って記述すること
- **テスト・ドキュメント**: コード変更時は、テストコードも合わせて変更し、ドキュメントも更新すること。さらにテストが必ず成功することを確認すること

### プロジェクト構成
- **ディレクトリ構成**: https://docs.python-guide.org/writing/structure/ を参考にした構成
- 推奨構成例:
  ```
  toto-prediction/
  ├── app/
  │   ├── __init__.py
  │   ├── main.py
  │   ├── batch/
  │   │   ├── __init__.py
  │   │   ├── scraper.py
  │   │   └── predictor.py
  │   ├── api/
  │   │   ├── __init__.py
  │   │   └── routes.py
  │   └── templates/
  │       └── index.html
  ├── requirements.txt
  ├── docker-compose.yml
  ├── Dockerfile
  └── README.md
  ```

## 技術的制約
- データの永続化は不要
- ローカル環境での動作が前提
- Dockerコンテナでの実行必須
